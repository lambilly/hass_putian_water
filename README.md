# è†ç”°æ°´è´¹ Home Assistant é›†æˆ

[![hacs_badge](https://img.shields.io/badge/HACS-Custom-orange.svg)](https://github.com/hacs/integration)

è¿™æ˜¯ä¸€ä¸ªç”¨äº Home Assistant çš„è‡ªå®šä¹‰é›†æˆï¼Œç”¨äºæŸ¥è¯¢è†ç”°æ°´åŠ¡çš„æ°´è´¹ä½™é¢å’Œè´¦å•ä¿¡æ¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” æ”¯æŒ Token å’Œ Cookie è®¤è¯
- ğŸ’° æ˜¾ç¤ºæ°´è´¹ä½™é¢ä¿¡æ¯
- ğŸ“Š æ˜¾ç¤ºä¸Šæœˆæ°´è´¹è´¦å•è¯¦æƒ…
- â° è‡ªåŠ¨æ¯æ—¥æ›´æ–°æ•°æ®
- ğŸ  åœ¨ Home Assistant ä¸­åˆ›å»ºä¼ æ„Ÿå™¨å®ä½“

## å®‰è£…

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ HACSï¼ˆæ¨èï¼‰

1. ç¡®ä¿å·²å®‰è£… [HACS](https://hacs.xyz/)
2. åœ¨ HACS ä¸­æ·»åŠ è‡ªå®šä¹‰ä»“åº“ï¼š
   - ä»“åº“ï¼š`lambilly/putian_water`
   - ç±»åˆ«ï¼šé›†æˆ
3. æœç´¢å¹¶å®‰è£… "è†ç”°æ°´è´¹"
4. é‡å¯ Home Assistant

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…

1. å°† `custom_components/putian_water` æ–‡ä»¶å¤¹å¤åˆ¶åˆ°ä½ çš„ Home Assistant çš„ `custom_components` ç›®å½•
2. é‡å¯ Home Assistant
3. åœ¨é›†æˆé¡µé¢æ·»åŠ  "è†ç”°æ°´è´¹"

## é…ç½®

### è·å–è®¤è¯ä¿¡æ¯

1. è®¿é—® [è†ç”°æ°´åŠ¡ç½‘ç«™](https://wt.ptswater.cn/)
2. ç™»å½•ä½ çš„è´¦æˆ·
3. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
4. æ‰¾åˆ°æ°´è´¹æŸ¥è¯¢çš„è¯·æ±‚ï¼Œå¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Token**: åœ¨è¯·æ±‚ä½“ä¸­çš„ `token` å­—æ®µ
   - **Cookie**: åœ¨è¯·æ±‚å¤´ä¸­çš„ `Cookie` å­—æ®µ

### æ·»åŠ é›†æˆ

1. è¿›å…¥ Home Assistant â†’ è®¾ç½® â†’ è®¾å¤‡ä¸æœåŠ¡
2. ç‚¹å‡» "æ·»åŠ é›†æˆ"
3. æœç´¢ "è†ç”°æ°´è´¹"
4. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **æ°´è¡¨å·ç **: ä½ çš„æ°´è¡¨å·
   - **è®¤è¯ä»¤ç‰Œ (Token)**: ä»ç½‘ç«™è·å–çš„ Token
   - **ä¼šè¯ Cookie**: ä»ç½‘ç«™è·å–çš„ Cookie
   - **æŸ¥è¯¢å¹´ä»½**: è¦æŸ¥è¯¢çš„å¹´ä»½ï¼ˆé»˜è®¤å½“å‰å¹´ä»½ï¼‰
   - **æ°´åŠ¡å…¬å¸ ID**: é»˜è®¤ä¸º 3
   - **åŒºåŸŸ ID**: é»˜è®¤ä¸º 0

## åˆ›å»ºçš„å®ä½“

é›†æˆä¼šåˆ›å»ºä»¥ä¸‹ä¼ æ„Ÿå™¨å®ä½“ï¼š

### æ°´è´¹ä½™é¢ä¼ æ„Ÿå™¨
- **å®ä½“ID**: `sensor.water_balance`
- **çŠ¶æ€**: å½“å‰è´¦æˆ·ä½™é¢
- **å±æ€§**:
  - æ°´è¡¨å·ç 
  - ç”¨æˆ·åœ°å€
  - ç”¨æˆ·çŠ¶æ€
  - æ¬ è´¹é‡‘é¢
  - ä¸Šæ¬¡è¯»æ•°æ—¥æœŸ
  - ä¸Šæ¬¡è¯»æ•°
  - å½“å‰ç”¨æ°´é‡

### ä¸Šæœˆæ°´è´¹ä¼ æ„Ÿå™¨
- **å®ä½“ID**: `sensor.last_water_bill`
- **çŠ¶æ€**: ä¸Šæœˆæ°´è´¹é‡‘é¢
- **å±æ€§**:
  - è´¦å•å‘¨æœŸ
  - ç”¨æˆ·åœ°å€
  - ç”¨æˆ·å§“å
  - ç”¨æˆ·ç¼–å·
  - æ°´è¡¨å·ç 
  - ä¸Šæ¬¡è¯»æ•°
  - æœ¬æ¬¡è¯»æ•°
  - ç”¨æ°´é‡
  - ç¼´è´¹çŠ¶æ€
  - ç¼´è´¹æ—¥æœŸ

## è‡ªåŠ¨åŒ–ç¤ºä¾‹

```yaml
# å½“æ°´è´¹ä½™é¢ä½äºé˜ˆå€¼æ—¶å‘é€é€šçŸ¥
automation:
  - alias: "æ°´è´¹ä½™é¢æé†’"
    trigger:
      - platform: numeric_state
        entity_id: sensor.water_balance
        below: 50
    action:
      - service: notify.mobile_app
        data:
          message: "æ°´è´¹ä½™é¢ä¸è¶³ï¼Œè¯·åŠæ—¶å……å€¼ï¼å½“å‰ä½™é¢ï¼š{{ states('sensor.water_balance') }}å…ƒ"

# æ¯æœˆ1æ—¥æŸ¥è¯¢æ°´è´¹è´¦å•
automation:
  - alias: "æ¯æœˆæ°´è´¹æŸ¥è¯¢"
    trigger:
      - platform: time
        at: "08:00:00"
    condition:
      - condition: time
        day: 1
    action:
      - service: homeassistant.update_entity
        target:
          entity_id:
            - sensor.water_balance
            - sensor.last_water_bill
